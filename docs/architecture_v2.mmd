graph TD
    %% â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    %% Don't Lie To Me v2.0 â€“ Simplified Production Architecture
    %% Microsoft Foundry Â· Agent Framework Â· Azure MCP Â·
    %% GitHub Copilot Â· Azure Services
    %% â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

    User["ğŸ‘¤ User"] -->|"HTTPS"| SWA

    %% â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    %% FRONTEND
    %% â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    SWA["Azure Static Web Apps<br/>Frontend Â· CDN Â· Auto SSL<br/>Staging per PR"]
    SWA -->|"API proxy"| FuncApp

    %% â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    %% BACKEND API
    %% â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    subgraph Compute["Azure Functions â€“ Python 3.11"]
        FuncApp["HTTP Endpoints<br/>/classify Â· /analyze<br/>/guidance Â· /health"]
    end

    FuncApp -->|"User input"| ContentSafety

    %% â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    %% MICROSOFT FOUNDRY
    %% â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    subgraph Foundry["Microsoft Foundry"]

        ContentSafety["Azure Content Safety<br/>Pre-filter Â· Jailbreak<br/>detection Â· PII redaction"]

        subgraph AgentService["Foundry Agent Service"]
            Orchestrator["Orchestrator Agent<br/>Intent routing"]
            ClassifyAgent["Classifier Agent<br/>SCAM Â· LIKELY<br/>SUSPICIOUS Â· SAFE"]
            AnalyzeAgent["Analyzer Agent<br/>Red flags Â· Persuasion<br/>Impersonation"]
            GuidanceAgent["Guidance Agent<br/>Safety steps<br/>Reporting Â· Prevention"]
        end

        GPT4o["GPT-4o<br/>Deep analysis"]
        GPT4oMini["GPT-4o mini<br/>Fast classification"]

    end

    ContentSafety -->|"Filtered"| Orchestrator
    Orchestrator --> ClassifyAgent
    Orchestrator --> AnalyzeAgent
    Orchestrator --> GuidanceAgent
    ClassifyAgent --> GPT4oMini
    AnalyzeAgent --> GPT4o
    GuidanceAgent --> GPT4o

    %% â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    %% AZURE MCP
    %% â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    subgraph MCP["Azure MCP Server"]
        MCPServer["MCP Tools Interface"]
        ToolStore["store_analysis"]
        ToolQuery["query_history"]
        ToolScam["check_known_scam"]
    end

    Orchestrator -->|"Tool calls<br/>MCP protocol"| MCPServer
    MCPServer --> ToolStore
    MCPServer --> ToolQuery
    MCPServer --> ToolScam

    %% â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    %% DATA
    %% â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    subgraph Data["Data Layer"]
        CosmosDB["Azure Cosmos DB<br/>NoSQL Â· PK: /sessionId"]
        BlobStorage["Azure Blob Storage<br/>Images Â· Logs"]
    end

    ToolStore -->|"Upsert"| CosmosDB
    ToolQuery -->|"Query"| CosmosDB
    ToolScam -->|"Query"| CosmosDB
    FuncApp -->|"Store images"| BlobStorage

    %% â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    %% CROSS-CUTTING
    %% â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    KeyVault["Azure Key Vault<br/>Secrets Â· Managed Identity"]
    AppInsights["Application Insights<br/>Tracing Â· Metrics Â· Alerts"]

    FuncApp -.->|"RBAC"| KeyVault
    FuncApp -.->|"Telemetry"| AppInsights
    Foundry -.->|"Agent traces"| AppInsights

    %% â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    %% CI/CD & COPILOT
    %% â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    subgraph DevPlatform["Developer Platform"]
        Copilot["GitHub Copilot<br/>Code gen Â· PR reviews"]
        Actions["GitHub Actions<br/>Build Â· Test Â· Deploy<br/>Bicep IaC validation"]
    end

    Copilot -.->|"Assists"| Actions
    Actions -.->|"Deploy"| SWA
    Actions -.->|"Deploy"| Compute

    %% â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    %% STYLES
    %% â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    classDef frontend fill:#00bcf2,stroke:#0099cc,color:#fff
    classDef compute fill:#0078d4,stroke:#005a9e,color:#fff
    classDef foundry fill:#6b3fa0,stroke:#4b2d73,color:#fff
    classDef mcp fill:#e3008c,stroke:#b4006c,color:#fff
    classDef data fill:#00a36c,stroke:#007a50,color:#fff
    classDef crosscut fill:#d83b01,stroke:#a52c00,color:#fff
    classDef monitor fill:#ffb900,stroke:#cc9400,color:#000
    classDef dev fill:#2ea043,stroke:#238636,color:#fff

    class SWA frontend
    class FuncApp compute
    class ContentSafety,Orchestrator,ClassifyAgent,AnalyzeAgent,GuidanceAgent,GPT4o,GPT4oMini foundry
    class MCPServer,ToolStore,ToolQuery,ToolScam mcp
    class CosmosDB,BlobStorage data
    class KeyVault crosscut
    class AppInsights monitor
    class Copilot,Actions dev
